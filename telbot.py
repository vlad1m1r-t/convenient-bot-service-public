import telebot
import sqlite3
import requests
import datetime
from bs4 import BeautifulSoup

con = sqlite3.connect("usersbot.db", check_same_thread=False) #–ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ –ë–î –≥–¥–µ "usersbot.db" –Ω–∞–∑–≤–∞–Ω–∏–µ –ë–î
cur = con.cursor() #–î–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ SQL-–∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞–º –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫—É—Ä—Å–æ—Ä –ë–î

token = '–í–∞—à —Ç–æ–∫–µ–Ω' #–í–∞—à —Ç–æ–∫–µ–Ω –¢–µ–ª–µ–≥—Ä–∞–º–º-–±–æ—Ç–∞ –ø–æ–ª—É—á–µ–Ω–Ω–Ω—ã–π —É BotFather –≤ —Å–∞–º–æ–º —Ç–µ–ª–µ–≥—Ä–∞–º–º–µ
bot = telebot.TeleBot(token) #–°–æ–∑–¥–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é bot –¥–ª—è –≤—ã–ø–æ–ª–µ–Ω–µ–Ω–∏—è –∫–æ–º–º–∞–Ω–¥ –±–æ—Ç–æ–º


@bot.message_handler(commands=['start']) #–°–æ–∑–¥–∞–µ–º –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –±–æ—Ç–∞ –ø–æ –∫–æ–º–∞–Ω–¥–µ /start
def check_reg_users(message): #–°–æ–∑–¥–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î
    info = cur.execute("SELECT chatid FROM users where chatid=?", (message.chat.id,)) #–ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –≤ –ë–î –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ chatid –≤ —Ç–∞–±–ª–∏—Ü–µ users
    if info.fetchone() is None: #–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ—Ç –≤ –ë–î, —Ç–æ –ø—Ä–∏–≤–µ—Å—Ç–≤—É–µ–º –µ–≥–æ –Ω–∞—á–∏–Ω–∞–µ–º –≤–Ω–æ—Å–∏—Ç—å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –Ω–∞–º –¥–∞–Ω–Ω—ã–µ
        bot.send_message(message.chat.id, f'–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å {message.from_user.first_name}! –Ø –∑–Ω–∞—é —Ç–æ–ª—å–∫–æ —Ç–≤–æ—ë –∏–º—è. –ü–æ–∑–≤–æ–ª—å —É–∑–Ω–∞—Ç—å –¥—Ä—É–≥—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–µ–±–µ!')
        cur.execute("INSERT INTO users (chatid, name) VALUES    (?,?)", (message.chat.id, message.from_user.first_name))
        msg = bot.send_message(message.chat.id, f'–ì–¥–µ —Ç—ã –∂–∏–≤–µ—à—å {message.from_user.first_name}? (–ü–æ–ª–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞)')
        bot.register_next_step_handler(msg, reg_city) #–ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –¥—Ä—É–≥—É—é —Ñ—É–Ω–∫—Ü–∏—é —á—Ç–æ–±—ã –≤–Ω–µ—Å—Ç–∏ –Ω–æ–≤—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ –ë–î –ø–æ —Å–æ–æ–±—â–µ–Ω–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        con.commit() #–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ë–î –ø–æ—Å–ª–µ –≤–Ω–µ—Å–µ–Ω–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
    else: #–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω —Ç–æ –ø—Ä–æ—Å—Ç–æ –µ–≥–æ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É–µ–º
        bot.send_message(message.chat.id, f'–Ø —Ç–µ–±—è —Å–Ω–æ–≤–∞ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é {message.from_user.first_name}!')

def reg_city(message): #–§—É–Ω–∫—Ü–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≥–æ—Ä–æ–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î
    cur.execute("UPDATE users SET city=? WHERE chatid=?", (message.text, message.chat.id,))#–¢–∞–∫ –∑–∞–ø–∏—Å—å —É–∂–µ —Å–æ–∑–¥–∞–Ω–∞ –ø–æ chatid, –∑–Ω–∞—á–∏—Ç –ø—Ä–æ—Å—Ç–æ –æ–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –≥–æ—Ä–æ–¥–∞
    con.commit() #–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ë–î –ø–æ—Å–ª–µ –≤–Ω–µ—Å–µ–Ω–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
    msg1 = bot.send_message(message.chat.id, f'–í—Å–µ–≥–¥–∞ –º–µ—á—Ç–∞–ª —Ç–∞–º –ø–æ–±—ã–≤–∞—Ç—å! –ö–∞–∫–∏–µ –Ω–æ–≤–æ—Å—Ç–∏ —Ç–µ–±—è –∏–Ω—Ç–µ—Ä–µ—Å—É—é—Ç? (–¢–µ–º—ã —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é!)')
    bot.register_next_step_handler(msg1, reg_themes) #–ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –¥—Ä—É–≥—É—é —Ñ—É–Ω–∫—Ü–∏—é —á—Ç–æ–±—ã –≤–Ω–µ—Å—Ç–∏ –Ω–æ–≤—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ –ë–î –ø–æ —Å–æ–æ–±—â–µ–Ω–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

def reg_themes(message): #–§—É–Ω–∫—Ü–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≥–æ—Ä–æ–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î
    cur.execute("UPDATE users SET themes=? WHERE chatid=?", (message.text, message.chat.id,)) #–¢–∞–∫ –∑–∞–ø–∏—Å—å —É–∂–µ —Å–æ–∑–¥–∞–Ω–∞ –ø–æ chatid, –∑–Ω–∞—á–∏—Ç –ø—Ä–æ—Å—Ç–æ –æ–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ —Ç–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    con.commit() #–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ë–î –ø–æ—Å–ª–µ –≤–Ω–µ—Å–µ–Ω–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
    bot.send_message(message.chat.id, f'–ê —É –Ω–∞—Å –≤–∫—É—Å—ã —Å–æ–≤–ø–∞–¥–∞—é—Ç! –ü—Ä–∏—è—Ç–Ω–æ –ø–æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è.\n–ü–æ–ø—Ä–æ–±—É–π —É –º–µ–Ω—è —á—Ç–æ-—Ç–æ —É–∑–Ω–∞—Ç—å {message.from_user.first_name}???')

@bot.message_handler(commands=['weather']) #–°–æ–∑–¥–∞–µ–º —Å–µ—Ä–≤–∏—Å –ü–æ–≥–æ–¥—ã –ø–æ –∫–æ–º–∞–Ω–¥–µ /weather
def get_weather(message): #–°–æ–∑–¥–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –ø–æ–≥–æ–¥—ã
    open_weather_token = '–í–∞—à —Ç–æ–∫–µ–Ω' #–ü–æ–≥–æ–¥—É –±–µ—Ä–µ–º —Å —Å–∞–π—Ç–∞ openweathermap –ø–æ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–º—É —Ç–æ–∫–µ–Ω—É –ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
    city_id = cur.execute("SELECT city FROM users WHERE chatid=?", (message.chat.id,)) #–ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –≥–æ—Ä–æ–¥ –∏–∑ –ë–î –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    city = [i for i in city_id.fetchone()] #–í—ã—Ç–∞—Å–∫–∏–≤–∞–µ–º –≥–æ—Ä–æ–¥ –∏–∑ –∑–∞–ø—Ä–æ—Å–∞

    url = requests.get(f'http://api.openweathermap.org/geo/1.0/direct?q={city},&appid={open_weather_token}') #–û–±—Ä–∞—â–∞–µ–º—Å—è –ø–æ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–∏ –≥–¥–µ —É–∫–∞–∑—ã–≤–∞–µ–º –≥–æ—Ä–æ–¥ –∏ —Ç–æ–∫–µ–Ω —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≥–æ—Ä–æ–¥–∞
    lat = url.json()[0]['lat'] #–í—ã—Ç–∞—Å–∫–∏–≤–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä –¥–æ–ª–≥–æ—Ç—ã
    lon = url.json()[0]['lon'] #–í—ã—Ç–∞—Å–∫–∏–≤–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä —à–∏—Ä–æ—Ç—ã
    urlweather = requests.get(
        f'https://api.openweathermap.org/data/2.5/weather?lat={lat}&lon={lon}&appid={open_weather_token}&units=metric') #–û–±—Ä–∞—â–∞–µ–º—Å—è –ø–æ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–∏ –≥–¥–µ —É–∫–∞–∑—ã–≤–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–æ–ª–≥–æ, —à–∏—Ä–∏–Ω—ã, –∏ —Ç–æ–∫–µ–Ω, —á—Ç–æ–±—ã –≤–∑—è—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ–≥–æ–¥—ã

    code_description = {
        "Clear": "–Ø—Å–Ω–æ \U00002600",
        "Clouds": "–û–±–ª–∞—á–Ω–æ \U00002601",
        "Rain": "–î–æ–∂–¥—å \U00002614",
        "Drizzle": "–î–æ–∂–¥—å \U00002614",
        "Thunderstorm": "–ì—Ä–æ–∑–∞ \U000026A1",
        "Snow": "–°–Ω–µ–≥ \U0001F328",
        "Mist": "–¢—É–º–∞–Ω \U0001F32B"
    }  #–°–æ–∑–¥–∞–µ–º —ç–º–æ–¥–∂–∏ –∏ –æ–ø–∏—Å–∞–Ω–∏–µ –ø–æ–≥–æ–¥—ã –¥–ª—è –∫—Ä–∞—Å–∏–≤–æ–≥–æ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è, –≤–∑—è–ª–∏ —Å–∞–º—ã–µ –≥–ª–∞–≤–Ω—ã–µ –≤–∏–¥—ã –ø–æ–≥–æ–¥

    weather_description = urlweather.json()["weather"][0]["main"] #–ë–µ—Ä–µ–º –≤–∏–¥—ã –ø–æ–≥–æ–¥
    if weather_description in code_description: #–°—Ä–∞–≤–Ω–∏–≤–∞–µ–º —Å –Ω–∞—à–∏—à–º –æ–ø–∏—Å–∞–Ω–∏–µ–º
        wd = code_description[weather_description]
    else: #–ï—Å–ª–∏ –Ω–µ—Ç —Ç–∞–∫–æ–π —Ä–∞–∑–Ω–æ–≤–∏–¥–Ω–æ—Å—Ç–∏ –ø–æ–≥–æ–¥—ã –≤ –Ω–∞—à–µ–º –æ–ø–∏—Å–∞–Ω–∏–∏, —Ç–æ –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤—ã–≥–ª—è–Ω—É—Ç—å –≤ –æ–∫–Ω–æ
        wd = '–ü–æ—Å–º–æ—Ç—Ä–∏ –ª—É—á—à–µ –≤ –æ–∫–Ω–æ, —è –Ω–µ –ø–æ–Ω–∏–º–∞—é —á—Ç–æ —Ç–∞–º –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç!'

    city_get = urlweather.json()["name"] #–ó–∞–±–∏—Ä–∞–µ–º –≥–æ—Ä–æ–¥ –ø–æ–≥–æ–¥—ã –≤–æ –∏–∑–±–µ–∂–∞–Ω–∏–∏ –æ—à–∏–±–æ–∫
    temp = urlweather.json()["main"]["temp"] #–ó–∞–±–∏—Ä–∞–µ–º —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É –Ω–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç
    temp_max = urlweather.json()["main"]["temp_max"] #–ó–∞–±–∏—Ä–∞–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É –Ω–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç
    temp_feels_like = urlweather.json()["main"]["feels_like"] #–ó–∞–±–∏—Ä–∞–µ–º —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É –ø–æ –æ—â—É—â–µ–Ω–∏—é —á–µ–ª–æ–≤–µ–∫–∞
    humidity = urlweather.json()["main"]["humidity"] #–ó–∞–±–∏—Ä–∞–µ–º –≤–ª–∞–∂–Ω–æ—Å—Ç—å
    bot.send_message(message.chat.id, f'–ü–æ–≥–æ–¥–∞ –≤ –≥–æ—Ä–æ–¥–µ: {city_get}\n–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: {temp}¬∞C –û—à—É—â–∞–µ—Ç—Å—è –∫–∞–∫: {temp_feels_like}¬∞C, {wd}\n'
          f'–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: {temp_max}¬∞C\n–í–ª–∞–∂–Ω–æ—Å—Ç—å: {humidity}%') #–û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø–æ–≥–æ–¥—É –ø–æ –µ–≥–æ –∑–∞–ø—Ä–æ—Å—É


@bot.message_handler(commands=['news']) #–°–æ–∑–¥–∞–µ–º —Å–µ—Ä–≤–∏—Å –ù–æ–≤–æ—Å—Ç–∏ –ø–æ –∫–æ–º–∞–Ω–¥–µ /news
def get_news(message): #–°–æ–∑–¥–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –Ω–æ–≤–æ—Å—Ç–µ–π
    themes = [i.split(',') for i in cur.execute("SELECT themes FROM users WHERE chatid=?", (message.chat.id,)).fetchone()] # –∑–∞–±–∏—Ä–∞–µ–º —Ç–µ–º—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    for t in range(len(themes[0])): #–°–æ–∑–¥–∞–µ–º —Ü–∏–∫–ª –Ω–æ–≤–æ—Å—Ç–µ–π –ø–æ –∫–∞–∂–¥–æ–π —Ç–µ–º–µ
        theme = themes[0][t]
        url = requests.get(f'https://newssearch.yandex.ru/news/search?text={theme}') #–û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ –ø–æ–∏—Å–∫ –Ω–æ–≤–æ—Å—Ç–µ–π –ø–æ –æ–¥–Ω–æ–π —Ç–µ–º–µ
        soup = BeautifulSoup(url.text, 'lxml')
        section_url = soup.find_all(class_="mg-snippet__url") #–ó–∞–±–∏—Ä–∞–µ–º –≤—Å–µ —Å—Å—ã–ª–∫–∏ –Ω–æ–≤–æ—Å—Ç–µ–π
        for i in range(5): #–°–æ–∑–¥–∞–µ–º —Ü–∏–∫–ª –¥–ª—è 5 –Ω–æ–≤–æ—Å—Ç–µ–π –ø–æ –∫–∞–∂–¥–æ–π —Ç–µ–º–µ
            news_href = section_url[i].findNext('a', href=True) #–ó–∞–±–∏—Ä–∞–µ–º –æ–¥–Ω—É —Å—Å—ã–ª–∫—É –∏–∑ –≤—Å–µ—Ö –Ω–∞–π–¥–µ–Ω—ã—Ö
            bot.send_message(message.chat.id,f'[–¢–≤–æ—è —Ç–µ–º–∞: {theme}]({news_href["href"]})', parse_mode='Markdown') #–û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

@bot.message_handler(commands=['rate']) #–°–æ–∑–¥–∞–µ–º —Å–µ—Ä–≤–∏—Å –ö—É—Ä—Å –æ—Å–Ω–æ–≤–Ω—ã—Ö –≤–∞–ª—é—Ç –ø–æ –∫–æ–º–∞–Ω–¥–µ /rate
def exchange_rate(message): #–°–æ–∑–¥–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –Ω–æ–≤–æ—Å—Ç–µ–π
    now = datetime.datetime.now()
    date = now.strftime('%d/%m/%Y') #–ó–∞–±–∏—Ä–∞–µ–º —Å–µ–≥–æ–¥–Ω—è—à–Ω—é—é –¥–∞—Ç—É, —Ç–∞–∫ –∫–∞–∫ –∑–∞–±—Ä–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –≤–∞–ª—é—Ç —Å —Ü–µ–Ω—Ç—Ä–æ–±–∞–Ω–∫–∞ –º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ –ø–æ –¥–∞—Ç–µ
    url = requests.get(f'https://cbr.ru/scripts/XML_daily.asp?date_req={date}') #–°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞ –¥–ª—è –≤–∑—è—Ç–∏—è –∫—É—Ä—Å–∞ –≤–∞–ª—é—Ç: –î–æ–ª–ª–∞—Ä–∞ –∏ –ï–≤—Ä–æ
    urlbitc = requests.get("https://www.blockchain.com/ru/ticker") #–ë–∏—Ç–∫–æ–∏–Ω –±—É–¥–µ–º –±—Ä–∞—Ç—å —Å –±–ª–æ–∫—á–µ–π–Ω–∞
    soup = BeautifulSoup(url.text, 'lxml')
    rate_usd = soup.find(id="R01235").find('value').text #–ó–∞–±–∏—Ä–∞–µ–º –∫—É—Ä—Å –î–æ–ª–ª–∞—Ä–∞
    rate_eur = soup.find(id="R01239").find('value').text #–ó–∞–±–∏—Ä–∞–µ–º –∫—É—Ä—Å –ï–≤—Ä–æ
    bot.send_message(message.chat.id, f'–ö—É—Ä—Å –î–æ–ª–ª–∞—Ä –°–®–ê: {rate_usd}—Ä üíµ\n–ö—É—Ä—Å –ï–≤—Ä–æ: {rate_eur}—Ä üí∂\n–ë–∏—Ç–∫–æ–∏–Ω: {urlbitc.json()["USD"]["last"]}$') #–û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

@bot.message_handler(commands=['update_city']) #–°–æ–∑–¥–∞–µ–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏–∑–º–µ–Ω–∏—Ç—å –≥–æ—Ä–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –∞–∫—Ç—É–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–≥–æ–¥–µ
def update_city(messange):
    new_city = bot.send_message(messange.chat.id, '–ü–µ—Ä–µ—Ö–∞–ª(–∞) –≤ –¥—Ä—É–≥–æ–π –≥–æ—Ä–æ–¥? –í–≤–µ–¥–∏ –Ω–æ–≤—ã–π –≥–æ—Ä–æ–¥(–ü–æ–ª–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ)')
    bot.register_next_step_handler(new_city,updatecity)
def updatecity(message):
    cur.execute("UPDATE users set city=? where chatid=?", (message.text, message.chat.id,))
    con.commit()
    bot.send_message(message.chat.id, f'–Ø –∑–∞–ø–æ–º–Ω–∏–ª! –¢–µ–ø–µ—Ä—å —Ç—ã –∂–∏–≤–µ—à—å –≤ "{message.text}"')

@bot.message_handler(commands=['update_themes']) #–°–æ–∑–¥–∞–µ–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏–∑–º–µ–Ω–∏—Ç—å —Ç–µ–º—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω—É–∂–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –Ω–æ–≤–æ—Å—Ç–µ–π
def update_themes(messange):
    new_themes = bot.send_message(messange.chat.id, '–•–æ—á–µ—à—å –ø–æ–º–µ–Ω—è—Ç—å —Ç–µ–º—ã? –í–≤–æ–¥–∏ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é!')
    bot.register_next_step_handler(new_themes,updatethemes)
def updatethemes(message):
    cur.execute("UPDATE users set themes=? where chatid=?", (message.text, message.chat.id,))
    con.commit()
    bot.send_message(message.chat.id, f'–Ø –∑–∞–ø–æ–º–Ω–∏–ª! –¢–µ–ø–µ—Ä—å —Ç—ã –∂–µ–ª–∞–µ—à—å –ø–æ–ª—É—á–∞—Ç—å –Ω–æ–≤–æ—Å—Ç–∏ –ø–æ —Ç–µ–º–µ(—Ç–µ–º–∞–º) "{message.text}"')

@bot.message_handler() #–õ—é–±–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –±–µ–∑ –∫–æ–º–∞–Ω–¥—ã
def dont_understand(message): #–°–æ–∑–¥–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –∫–æ—Ç–æ—Ä–∞—è –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å–æ–æ–±—â–µ–Ω–∏—è
    if '–ü–æ–≥–æ–¥'.lower() in message.text.lower(): #–ï—Å–ª–∏ –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å–æ–¥–µ—Ä–∂–∏—Ç—Å—è —Å–ª–æ–≤–æ –ü–û–ì–û–î, —Ç–æ –≤—ã–ø–æ–ª—è–µ—Ç—Å—è —Å–µ—Ä–≤–∏—Å –ü–æ–≥–æ–¥–∞
        get_weather(message)
    elif '–ü—Ä–∏–≤–µ—Ç'.lower() in message.text.lower(): #–ï—Å–ª–∏ –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å–æ–¥–µ—Ä–∂–∏—Ç—Å—è —Å–ª–æ–≤–æ –ü—Ä–∏–≤–µ—Ç, —Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –ª–∏ –æ–Ω
        check_reg_users(message)
    elif '–ù–æ–≤–æ—Å—Ç'.lower() in message.text.lower(): #–ï—Å–ª–∏ –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å–æ–¥–µ—Ä–∂–∏—Ç—Å—è —Å–ª–æ–≤–æ –ù–æ–≤–æ—Å—Ç, —Ç–æ –≤—ã–ø–æ–ª—è–µ—Ç—Å—è —Å–µ—Ä–≤–∏—Å –ù–æ–≤–æ—Å—Ç–∏
        get_news(message)
    elif '–î–æ–ª–ª'.lower() in message.text.lower() or '–ï–≤—Ä'.lower() in message.text.lower() or '–ë–∏—Ç–∫–æ–∏'.lower() in message.text.lower() or '–ö—É—Ä—Å'.lower() in message.text.lower():
        exchange_rate(message)
    elif '–û–±–Ω–æ–≤–∏ –≥–æ—Ä–æ–¥'.lower() in message.text.lower() or '–ò–∑–º–µ–Ω–∏ –≥–æ—Ä–æ–¥'.lower() in message.text.lower():
        update_city(message)
    elif '–û–±–Ω–æ–≤–∏ —Ç–µ–º'.lower() in message.text.lower() or '–ò–∑–º–µ–Ω–∏ —Ç–µ–º'.lower() in message.text.lower():
        update_themes(message)
    else: #–ï—Å–ª–∏ –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏ –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç—Å—è —Å–ª–æ–≤ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π –∫–æ–º–∞–Ω–¥—ã, —Ç–æ –±–æ—Ç —Å–æ–æ–±—â–∞–µ—Ç —Å–≤–æ–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
        bot.send_message(message.chat.id, '–ú–æ—è —Ç–≤–æ—è –Ω–µ –ø–æ–Ω–∏–º–∞—Ç—å!')
        bot.send_message(message.chat.id, f'–ó–Ω–∞—é –∫–æ–º–∞–Ω–¥—ã:\n'
                                          f'/start - –î–ª—è —Ç–µ—Ö –∫–æ–≥–æ —è –µ—â–µ –Ω–µ –∑–∞–ø–æ–º–Ω–∏–ªüòë\n'
                                          f'/weather –∏–ª–∏ —Å–ª–æ–≤–æ –ü–û–ì–û–î–ê - –ï—Å–ª–∏ –ª–µ–Ω—å –≤—ã–≥–ª—è–¥—ã–≤–∞—Ç—å –≤ –æ–∫–Ω–æüò§ –∏ –∂–µ–ª–∞–µ—à—å —É–∑–Ω–∞—Ç—å –ø–æ–≥–æ–¥—É!‚òÇ\n'
                                          f'/news –∏–ª–∏ —Å–ª–æ–≤–æ –ù–û–í–û–°–¢–ò  - –ï—Å–ª–∏ –∂–µ–ª–∞–µ—à—å –ø–æ—á–∏—Ç–∞—Ç—å –∏–Ω—Ç–µ—Ä–µ—Å—É—é—â–∏–µ —Ç–µ–±—è —Ç–µ–º—ã –∫–æ—Ç–æ—Ä—ã–µ —Ç—ã –º–Ω–µ —Ä–∞—Å—Å–∫–∞–∑–∞–ª'
                                          f' –ø–æ —Å–µ–∫—Ä–µ—Ç—Éü§´\n'
                                          f'/rate –∏–ª–∏ —Å–ª–æ–≤–∞ –í–ê–õ–Æ–¢–ê,–î–û–õ–õ–ê–†,–ï–í–†–û,–ë–ò–¢–ö–û–ò–ù - –ï—Å–ª–∏ –∂–µ–ª–∞–µ—à—å —É–∑–Ω–∞—Ç—å –Ω–µ —É–º–µ–Ω—å—à–∏–ª–∏—Å—å –ª–∏ —Ç–≤–æ–∏ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—èüòÅ, –Ω—É –∏ –∑–∞–æ–¥–Ω–æ –∫—É—Ä—Å'
                                          f' –≤–∞–ª—é—ÇüëÄ\n'
                                          f'/update_city –∏–ª–∏ –ò–ó–ú–ï–ù–ò –ì–û–†–û–î, –û–ë–ù–û–í–ò –ì–û–†–û–î —á—Ç–æ–±—ã –æ–±–Ω–æ–≤–∏—Ç—å —Ç–≤–æ–π –≥–æ—Ä–æ–¥ –¥–ª—è –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç–∏ –ø–æ–≥–æ–¥—ã\n'
                                          f'/update_themes –∏–ª–∏ –ò–ó–ú–ï–ù–ò –¢–ï–ú–´, –û–ë–ù–û–í–ò –¢–ï–ú–´ —á—Ç–æ–±—ã –æ–±–Ω–æ–≤–∏—Ç—å –∏–Ω—Ç–µ—Ä–µ—Å—É—é—â–∏–µ —Ç–µ–±—è —Ç–µ–º—ã –¥–ª—è –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç–∏ –Ω–æ–≤–æ—Å—Ç–µ–π')



if __name__ == '__main__':
    bot.infinity_polling(none_stop=True, timeout=123, skip_pending=True)